<!DOCTYPE html>
<html lang="en">
  <head>
    <base href="/" />
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Dev-friendly settings -->
    <meta name="flutter-web-renderer" content="html" />
    <meta name="flutter-service-worker" content="false" />

    <title>ShiftOS</title>
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/png" href="favicon.png" />

    <!-- Flutter runtime -->
    <script defer src="flutter.js"></script>

    <!-- Minimal bootstrap + error surfacing (inline on purpose for DEV) -->
    <script>
      (function () {
        const loading = document.getElementById('app-loading');
        const errEl = document.getElementById('app-error');

        function showError(msg) {
          try { console.error('ShiftOS bootstrap error:', msg); } catch (_) {}
          if (loading) loading.style.display = 'none';
          if (errEl) {
            errEl.style.display = 'block';
            errEl.textContent = 'Failed to start: ' + (msg && (msg.message || String(msg)) || 'Unknown error');
          }
        }

        window.addEventListener('error', (e) => showError(e.error || e.message || 'Script error'));
        window.addEventListener('unhandledrejection', (e) => showError(e.reason || e));

        window.addEventListener('load', function () {
          try {
            if (!window._flutter || !window._flutter.loader) {
              showError('flutter.js not loaded or loader unavailable.');
              return;
            }
            window._flutter.loader.loadEntrypoint({
              onEntrypointLoaded: function (engineInitializer) {
                engineInitializer.initializeEngine()
                  .then(function (appRunner) {
                    if (loading) loading.remove();
                    return appRunner.runApp();
                  })
                  .catch(showError);
              }
            });
          } catch (e) {
            showError(e);
          }
        });
      })();
    </script>
  </head>
  <body>
    <div id="app-loading" role="status" aria-live="polite" style="font-family:system-ui,sans-serif;padding:1rem">
      Loading ShiftOSâ€¦
    </div>
    <div id="app-error" role="alert" style="display:none;color:#b00020;font-family:system-ui,sans-serif;padding:1rem"></div>
    <noscript>
      <p style="font-family:system-ui,sans-serif;padding:1rem;color:#b00020">
        ShiftOS needs JavaScript enabled.
      </p>
    </noscript>
  </body>
</html>
